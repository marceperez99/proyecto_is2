{% extends 'base.html' %}
{% block title %}{{ item }}{% endblock %}
{% block content %}
    {% include 'navBar.html' %}
    {% include 'breadcrumb.html' %}
    <div class="container mt-3">

        <div class="row">
            {% include 'mensajes.html' %}
            <h3 class="col-4">Item de Proyecto</h3>
            <div class="col-8 text-right">

                {% if item.estado == 'No Aprobado' %}
                    <a href="{% url 'solicitar_aprobacion_item' proyecto.id fase.id item.id %}" class="btn btn-success  border-0">Solicitar Aprobación de Item</a>

                {% elif item.estado == 'Listo para su aprobación' %}
                    <a href="{% url 'aprobar_item' proyecto.id fase.id item.id %}" class="btn btn-success  border-0">Aprobar Item</a>
                    <a href="#" class="btn btn-danger bg-color-danger border-0">Cancelar Aprobación</a>
                {% endif %}

                {% if item.estado == 'No Aprobado' %}
                    <a href="{% url 'editar_item' proyecto.id fase.id item.id %}" class="btn btn-primary bg-color-accent border-0">Modificar Item</a>
                {% endif %}
                {% if item.estado == 'Aprobado' %}
                    <a href="{% url 'desaprobar_item' proyecto.id fase.id item.id %}" class="btn btn-danger bg-color-danger border-0">Desaprobar Item</a>
                {% endif %}
                {% if se_puede_eliminar %}
                <a href="{% url 'eliminar_item' proyecto.id fase.id item.id %}" class="btn btn-danger bg-color-danger border-0">Eliminar Item</a>
                {% endif %}
            </div>
            <hr class="col-12">

            <div class="col-10 bg-white border rounded p-3 mx-auto">
                <div class="row">
                    <div class="col-4 h5 my-3">Codigo</div><div class="col-8 my-3">{{ item.codigo }}</div>
                    <div class="col-4 h5 my-3">Nombre</div><div class="col-8 my-3">{{ item.version.nombre }}</div>
                    <div class="col-4 h5 my-3">Descripcion</div><div class="col-8 my-3">{{ item.version.descripcion }}</div>
                    <div class="col-4 h5 my-3">Estado</div><div class="col-8 my-3">{{ item.estado }}</div>
                    <div class="col-4 h5 my-3">Version</div>
                    <div class="col-8 my-3">{{ item.version.version }}</div>
                    {% for atr in item.get_atributos_dinamicos %}
                    <div class="col-4 h5 my-3">{{atr.plantilla.nombre}}</div>
                        <div class="col-8 my-3">
                            {% if atr.valor == None %}
                            {% elif atr.valor == True %}
                            Si
                            {% elif atr.valor == False %}
                            No
                            {% else %}
                            {% if atr.valor.normalize %}
                            {{atr.valor.normalize}}
                            {% else %}
                            {% if atr.getTipoAtributo != "Archivo" %}
                                        {{atr.valor}}
                            {% else %}
                            <button class="btn btn-primary mr-3 border-0 bg-color-accent"
                                    onclick="window.open('{{atr.valor}}')">
                                Ver Archivo
                            </button>
                            {% endif %}
                            {% endif %}
                            {% endif %}
                        </div>
                    {% endfor %}
                    <hr class="col-11">
                    <h5 class="col-12 my-3">Relaciones</h5>
                    <div class="col-12">
                        <ul class="nav nav-tabs" id="myTab" role="tablist">
                            <li class="nav-item">
                                <a class="nav-link active" id="padres-tab" data-toggle="tab" href="#padres" role="tab" aria-controls="padres" aria-selected="true">Padres</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="hijos-tab" data-toggle="tab" href="#hijos" role="tab" aria-controls="hijos" aria-selected="false">Hijos</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="antecesores-tab" data-toggle="tab" href="#antecesores" role="tab" aria-controls="antecesores" aria-selected="false">Antecesores</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" id="sucesores-tab" data-toggle="tab" href="#sucesores" role="tab" aria-controls="sucesores" aria-selected="false">Sucesores</a>
                            </li>
                            <li class="nav-item ml-auto">
                                <a href="{% url 'relacionar_item' proyecto.id fase.id item.id %}" class="btn btn-primary ml-auto border-0 bg-color-accent">Relacionar Item</a>
                            </li>
                        </ul>
                        <div class="tab-content" id="myTabContent">
                            <div class="tab-pane fade show active" id="padres" role="tabpanel" aria-labelledby="padres-tab">
                                <div class="row my-3">
                                    <p class="col-10 mx-auto">Estos son los padres de este item</p>
                                    <div class="col-10 mx-auto">
                                        {% if item.get_padres %}
                                            <table class="table tablet-responsive">
                                                <thead>
                                                    <tr><th>Codigo</th><th>Nombre</th><th></th></tr>
                                                </thead>
                                                <tbody>
                                                    {% for padre in item.get_padres %}
                                                        <tr>
                                                            <td>{{ padre.get_version }}</td><td>{{ padre }}</td>
                                                            <td class="text-right">
                                                                <a href="{% url 'visualizar_item' proyecto.id fase.id padre.id %}" class="btn btn-primary border-0">
                                                                    <i class="fas fa-eye"></i> Visualizar
                                                                </a>
                                                                <a href="{% url 'eliminar_relacion_item' proyecto.id fase.id item.id padre.id %}" class="btn btn-danger">Eliminar</a>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                                </table>
                                        {% else %}
                                            <p class="lead">El item no tiene ningun padre aun.</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="antecesores" role="tabpanel" aria-labelledby="antecesores-tab">
                                <div class="row my-3">
                                      <p class="col-10 mx-auto">Estos son los Antecesores de este item</p>
                                      <div class="col-10 mx-auto">
                                            {% if item.get_antecesores %}
                                                <table class="table tablet-responsive">
                                                    <thead>
                                                        <tr><th>Codigo</th><th>Nombre</th><th></th></tr>
                                                    </thead>
                                                    <tbody>
                                                        {% for antecesor in item.get_antecesores %}
                                                            <tr>
                                                            <td>{{ antecesor.get_version }}</td><td>{{ antecesor }}</td>
                                                            <td class="text-right">
                                                                <a href="{% url 'visualizar_item' proyecto.id fase.id antecesor.id %}" class="btn btn-primary border-0">
                                                                    <i class="fas fa-eye"></i> Visualizar
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                    </tbody>
                                                </table>
                                            {% else %}
                                                <p class="lead">El item no tiene ningun antecesor.</p>
                                            {% endif %}
                                      </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="hijos" role="tabpanel" aria-labelledby="hijos-tab">
                                <div class="row my-3">
                                    <p class="col-10 mx-auto">Estos son los hijos de este item</p>
                                    <div class="col-10 mx-auto">
                                        {% if item.get_hijos %}
                                            <table class="table tablet-responsive">
                                                <thead>
                                                    <tr><th>Codigo</th><th>Nombre</th><th></th></tr>
                                                </thead>
                                                <tbody>
                                                    {% for hijo in item.get_hijos %}
                                                        <tr>
                                                            <td>{{ hijo.get_version }}</td><td>{{ hijo }}</td>
                                                            <td class="text-right">
                                                                <a href="{% url 'visualizar_item' proyecto.id fase.id hijo.id %}" class="btn btn-primary border-0">
                                                                    <i class="fas fa-eye"></i> Visualizar
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% else %}
                                            <p class="lead">El item no tiene ningun hijo aun.</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            <div class="tab-pane fade" id="sucesores" role="tabpanel" aria-labelledby="sucesores-tab">
                                <div class="row my-3">
                                    <p class="col-10 mx-auto">Estos son los Sucesores de este item</p>
                                    <div class="col-10 mx-auto">
                                        {% if item.get_sucesores %}
                                            <table class="table tablet-responsive">
                                                <thead>
                                                    <tr><th>Codigo</th><th>Nombre</th><th></th></tr>
                                                </thead>
                                                <tbody>
                                                    {% for sucesor in item.get_sucesores %}
                                                        <tr>
                                                            <td>{{ sucesor.get_version }}</td><td>{{ sucesor }}</td>
                                                            <td class="text-right">
                                                                <a href="{% url 'visualizar_item' proyecto.id fase.id sucesor.id %}" class="btn btn-primary border-0">
                                                                    <i class="fas fa-eye"></i> Visualizar
                                                                </a>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        {% else %}
                                            <p class="lead">El item no tiene ningun sucesor aun.</p>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <hr class="col-11">
                    <div class="col-auto ml-auto"><a href="{% url 'historial_item' proyecto.id fase.id item.id %}" class="btn ml-auto btn-primary bg-color-accent">Visualizar Historial de Cambios</a></div>

                </div>
            </div>
        </div>
    </div>
{% endblock %}